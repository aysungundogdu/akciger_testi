<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title id="main-title">Solunum Analizi & Wim Hof Egzersizi</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary: #22b8cf;
            --primary-hover: #15aabf;
            --bg: #f8fafc;
            --card-bg: #ffffff;
            --text-main: #334155;
            --text-muted: #94a3b8;
            --border-color: #f1f5f9;
            --accent-light: #e3f9fd;
            --warning-bg: #fff7ed;
            --warning-text: #9a3412;
            --info-bg: #eff6ff;
            --info-text: #1e40af;
            --wimhof-accent: #3b82f6;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            margin: 0;
            font-family: 'Inter', sans-serif;
            background: var(--bg);
            color: var(--text-main);
            padding-bottom: env(safe-area-inset-bottom, 20px);
            overflow-x: hidden; /* Yatay kaymayı önler */
        }

        header {
            background: #fff;
            padding: 10px 15px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.02);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-left h1 { margin: 0; font-size: 18px; font-weight: 700; color: #1e293b; }
        
        .lang-select {
            padding: 4px 8px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            font-size: 13px;
            outline: none;
            cursor: pointer;
            background: #fff;
        }

        .tabs {
            display: flex;
            gap: 5px;
            border-bottom: 1px solid var(--border-color);
            overflow-x: auto;
            scrollbar-width: none;
            -webkit-overflow-scrolling: touch;
        }
        .tabs::-webkit-scrollbar { display: none; }

        .tab-btn {
            padding: 8px 12px;
            border: none;
            background: none;
            font-weight: 600;
            color: var(--text-muted);
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.2s;
            white-space: nowrap;
            font-size: 14px;
        }

        .tab-btn.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }

        .container {
            width: 100%;
            max-width: 1200px;
            margin: 15px auto;
            padding: 0 15px;
        }

        .page { display: none; width: 100%; }
        .page.active { display: block; }

        /* Masaüstü Grid Sistemi */
        @media (min-width: 901px) {
            .test-grid { 
                display: grid;
                grid-template-columns: 1.8fr 1fr;
                gap: 25px;
            }
        }

        .card {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.03);
            border: 1px solid rgba(0,0,0,0.02);
            margin-bottom: 20px;
            width: 100%;
        }

        .medical-disclaimer {
            background: var(--warning-bg);
            color: var(--warning-text);
            padding: 10px;
            border-radius: 10px;
            font-size: 11px;
            margin-bottom: 15px;
            border: 1px solid #ffedd5;
        }

        .visualizer-container {
            height: 150px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 15px;
        }

        .breath-circle {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, var(--primary), #67e8f9);
            border-radius: 50%;
            box-shadow: 0 10px 30px rgba(34, 184, 207, 0.3);
            transition: transform 1.5s ease-in-out;
        }

        .breathing { animation: breathe 4s infinite ease-in-out; }
        @keyframes breathe {
            0%, 100% { transform: scale(1); opacity: 0.8; }
            50% { transform: scale(1.5); opacity: 1; }
        }

        .how-to-box {
            background: var(--accent-light);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .step-item { display: flex; align-items: flex-start; margin-bottom: 8px; font-size: 13px; color: #0c525d; }
        .step-num { flex-shrink: 0; width: 20px; height: 20px; background: var(--primary); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 10px; font-weight: bold; margin-right: 10px; margin-top: 2px; }

        .timer-display { text-align: center; padding: 10px 0; }
        .timer-display .value { font-size: 48px; font-weight: 800; color: #1e293b; }

        .btn { flex: 1; padding: 12px 20px; border-radius: 12px; border: none; font-weight: 600; cursor: pointer; transition: all 0.2s; font-size: 15px; }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; }
        .btn-start { background: var(--primary); color: white; }
        .btn-stop { background: #f1f5f9; color: #64748b; }

        .exercise-status { font-size: 16px; font-weight: 700; color: var(--wimhof-accent); margin-bottom: 5px; text-transform: uppercase; text-align: center; }
        .breath-counter { font-size: 20px; font-weight: 800; color: #1e293b; margin-top: 5px; text-align: center; }
        .instruction-text { font-size: 14px; color: var(--text-main); text-align: center; margin: 10px 0; min-height: 40px; }

        .data-table-wrapper { overflow-x: auto; margin: 15px 0; border-radius: 10px; border: 1px solid var(--border-color); }
        .data-table { width: 100%; border-collapse: collapse; background: white; font-size: 13px; min-width: 450px; }
        .data-table th, .data-table td { padding: 12px; text-align: left; border-bottom: 1px solid var(--border-color); }

        .info-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 10px; margin-top: 15px; }
        .info-card-small { background: #f8fafc; padding: 12px; border-radius: 12px; border-left: 4px solid var(--primary); }
        .info-card-small h4 { margin: 0 0 5px 0; font-size: 13px; }
        .info-card-small p { margin: 0; font-size: 12px; color: var(--text-muted); }

        .result-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px; }
        .result-item { background: white; padding: 12px; border-radius: 10px; border: 1px solid var(--border-color); text-align: center; }
        .result-item label { display: block; font-size: 10px; color: var(--text-muted); margin-bottom: 3px; text-transform: uppercase; }
        .result-item span { font-size: 18px; font-weight: 800; color: var(--primary); }

        footer { text-align: center; padding: 20px; font-size: 12px; color: var(--text-muted); margin-top: 20px; }

        .stat-row { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid var(--border-color); font-size: 13px; }
    </style>
</head>
<body>

<header>
    <div class="header-top">
        <div class="header-left">
            <h1 data-i18n="header-title">Solunum & Kondisyon Analizi</h1>
        </div>
        <div class="header-right" style="display:flex; align-items:center; gap:10px;">
            <select id="langSelect" class="lang-select">
                <option value="tr">TR</option>
                <option value="en">EN</option>
                <option value="es">ES</option>
            </select>
        </div>
    </div>
    <nav class="tabs" role="tablist">
        <button class="tab-btn active" onclick="switchTab(event, 'test-page')" data-i18n="tab-test">Test Yap</button>
        <button class="tab-btn" onclick="switchTab(event, 'exercise-page')" data-i18n="tab-exercise">Egzersiz</button>
        <button class="tab-btn" onclick="switchTab(event, 'info-page')" data-i18n="tab-info">Bilgi</button>
    </nav>
</header>

<div class="container">
    <main id="test-page" class="page active test-grid">
        <section>
            <div class="card">
                <div class="medical-disclaimer" data-i18n="medical-disclaimer">
                    <strong>⚠️ ÖNEMLİ UYARI:</strong> Bu uygulama tıbbi teşhis değildir.
                </div>

                <div class="visualizer-container">
                    <div id="breathCircle" class="breath-circle breathing"></div>
                </div>

                <div class="how-to-box">
                    <div class="step-item"><div class="step-num">1</div> <span data-i18n="test-step-1">Nefes al ve daire büyüdüğünde tut.</span></div>
                    <div class="step-item"><div class="step-num">2</div> <span data-i18n="test-step-2"><b>Başlat</b>'a bas ve tutmaya devam et.</span></div>
                </div>

                <div class="timer-display">
                    <span class="value" id="time">0</span><span style="font-size:18px; color:var(--text-muted); margin-left:5px;" data-i18n="unit-sec">sn</span>
                </div>

                <div class="button-group" style="display:flex; gap:10px;">
                    <button id="start" class="btn btn-start" data-i18n="btn-start-test">Başlat</button>
                    <button id="stop" class="btn btn-stop" disabled data-i18n="btn-stop">Durdur</button>
                </div>

                <div id="resultCard" style="opacity: 0.6; margin-top: 15px;">
                    <div class="result-grid">
                        <div class="result-item">
                            <label data-i18n="label-lung-age">Akciğer Yaşı</label>
                            <span id="lungAge">-</span>
                        </div>
                        <div class="result-item">
                            <label data-i18n="label-vo2-max">VO₂ Max</label>
                            <span id="vo2Max">-</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <aside>
            <div class="card">
                <h3 style="font-size:14px; margin-top:0;" data-i18n="summary-data">Özet Veriler</h3>
                <div class="stat-row"><span data-i18n="stat-total">Toplam Test</span><span class="val" id="totalTests">0</span></div>
                <div class="stat-row"><span data-i18n="stat-avg">Ortalama</span><span class="val" id="avgScore">–</span></div>
            </div>
            <div class="card" style="padding: 10px;">
                <canvas id="chart" style="width: 100%; height: 180px;"></canvas>
            </div>
        </aside>
    </main>

    <main id="exercise-page" class="page">
        <div class="card" style="text-align: center;">
            <div id="exStatus" class="exercise-status" data-i18n="badge-ready">Hazır</div>
            <div class="visualizer-container">
                <div id="exCircle" class="breath-circle" style="background: linear-gradient(135deg, var(--wimhof-accent), #60a5fa);"></div>
            </div>
            <div id="exInstruction" class="instruction-text" data-i18n="ex-start-instruction">Hazır olduğunda başla.</div>
            <div id="exCounter" class="breath-counter">0 / 30</div>
            <div class="button-group" style="display:flex; justify-content:center;">
                <button id="exStart" class="btn btn-start" style="background: var(--wimhof-accent)" data-i18n="btn-start-ex">Başlat</button>
            </div>
        </div>
    </main>

    <main id="info-page" class="page">
        <div class="card">
            <h3 data-i18n="info-title" style="margin-top:0">VO₂ Max Nedir?</h3>
            <p style="font-size:14px" data-i18n="info-p1">Vücudunuzun dakikada kilogram başına ne kadar oksijen kullanabildiğini gösteren bu değer, kardiyovasküler kondisyonunuzun göstergesidir.</p>
            <div class="data-table-wrapper">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th data-i18n="th-age">Yaş</th>
                            <th data-i18n="th-male">Erkek</th>
                            <th data-i18n="th-female">Kadın</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td>20-29</td><td>40-45</td><td>35-40</td></tr>
                        <tr><td>30-39</td><td>38-43</td><td>33-38</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
    </main>

    <footer>
        &copy; 2026 Oxygen Harmony
    </footer>
</div>

<script>
    const translations = {
        tr: {
            "header-title": "Solunum Analizi",
            "tab-test": "Test",
            "tab-exercise": "Egzersiz",
            "tab-info": "Bilgi",
            "medical-disclaimer": "<strong>⚠️ UYARI:</strong> Tıbbi teşhis aracı değildir.",
            "test-step-1": "Nefes al ve daire büyüdüğünde tut.",
            "test-step-2": "Başlat'a bas ve tutmaya devam et.",
            "unit-sec": "sn",
            "btn-start-test": "Başlat",
            "btn-stop": "Durdur",
            "label-lung-age": "Akciğer Yaşı",
            "label-vo2-max": "VO₂ Max",
            "summary-data": "Özet Veriler",
            "stat-total": "Toplam",
            "stat-avg": "Ortalama",
            "badge-ready": "Hazır",
            "btn-start-ex": "Egzersizi Başlat",
            "ex-start-instruction": "Hazır olduğunda başla.",
            "info-title": "VO₂ Max Nedir?",
            "info-p1": "Oksijen kullanma kapasitesidir.",
            "th-age": "Yaş",
            "th-male": "Erkek",
            "th-female": "Kadın",
            "age-unit": " Yaş"
        },
        en: {
            "header-title": "Breath Analysis",
            "tab-test": "Test",
            "tab-exercise": "Exercise",
            "tab-info": "Info",
            "medical-disclaimer": "<strong>⚠️ WARNING:</strong> Not a medical tool.",
            "test-step-1": "Inhale and hold on expansion.",
            "test-step-2": "Press start and keep holding.",
            "unit-sec": "sec",
            "btn-start-test": "Start",
            "btn-stop": "Stop",
            "label-lung-age": "Lung Age",
            "label-vo2-max": "VO₂ Max",
            "summary-data": "Stats",
            "stat-total": "Total",
            "stat-avg": "Average",
            "badge-ready": "Ready",
            "btn-start-ex": "Start Exercise",
            "ex-start-instruction": "Start when ready.",
            "info-title": "What is VO₂ Max?",
            "info-p1": "Oxygen usage capacity.",
            "th-age": "Age",
            "th-male": "Male",
            "th-female": "Female",
            "age-unit": " Years"
        }
    };

    let currentLang = 'tr';
    const AppState = {
        results: JSON.parse(localStorage.getItem('lung_results') || '[]'),
        chart: null,
        timer: null
    };

    function switchTab(e, tabId) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(tabId).classList.add('active');
        e.currentTarget.classList.add('active');
    }

    function updateLanguage(lang) {
        currentLang = lang;
        document.querySelectorAll('[data-i18n]').forEach(el => {
            const key = el.getAttribute('data-i18n');
            if (translations[lang][key]) el.innerHTML = translations[lang][key];
        });
        updateStats();
    }

    function initChart() {
        const ctx = document.getElementById('chart').getContext('2d');
        AppState.chart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: AppState.results.map((_, i) => i + 1),
                datasets: [{
                    label: 'Süre',
                    data: AppState.results,
                    borderColor: '#22b8cf',
                    tension: 0.3,
                    fill: false
                }]
            },
            options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } } }
        });
    }

    function updateStats() {
        document.getElementById('totalTests').textContent = AppState.results.length;
        if(AppState.results.length > 0) {
            const avg = AppState.results.reduce((a,b) => a+b, 0) / AppState.results.length;
            document.getElementById('avgScore').textContent = Math.round(avg) + " " + translations[currentLang]["unit-sec"];
        }
    }

    document.getElementById('start').onclick = function() {
        let sec = 0;
        this.disabled = true;
        document.getElementById('stop').disabled = false;
        document.getElementById('resultCard').style.opacity = "1";
        document.getElementById('breathCircle').classList.remove('breathing');
        document.getElementById('breathCircle').style.transform = "scale(1.5)";

        AppState.timer = setInterval(() => {
            sec++;
            document.getElementById('time').textContent = sec;
            let age = Math.max(18, 25 + (45 - sec) * 1.2);
            document.getElementById('lungAge').textContent = Math.round(age) + (translations[currentLang]["age-unit"] || " Yaş");
            document.getElementById('vo2Max').textContent = (sec * 0.35 + 22).toFixed(1);
        }, 1000);

        document.getElementById('stop').onclick = () => {
            clearInterval(AppState.timer);
            this.disabled = false;
            document.getElementById('stop').disabled = true;
            document.getElementById('breathCircle').style.transform = "scale(1)";
            setTimeout(() => document.getElementById('breathCircle').classList.add('breathing'), 500);
            
            AppState.results.push(sec);
            localStorage.setItem('lung_results', JSON.stringify(AppState.results));
            AppState.chart.data.labels.push(AppState.results.length);
            AppState.chart.data.datasets[0].data.push(sec);
            AppState.chart.update();
            updateStats();
        };
    };

    document.getElementById('langSelect').onchange = (e) => updateLanguage(e.target.value);

    window.onload = () => {
        initChart();
        updateStats();
        updateLanguage('tr');
    };
</script>

</body>
</html>
